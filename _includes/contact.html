<section id="contact" class="new-section">
  <!-- Honeypot field -->
  <div class="hidden-field">
    <input type="text"
           id="website"
           name="website"
           autocomplete="off"
           tabindex="-1"
           placeholder="Leave this field empty">
  </div>
  <div class="contacts-container">
    <h2>Get In Touch</h2>
    <div class="contacts-content">
      <!-- Contact Info Cards -->
      <div class="contact-info">
        <div class="contact-card">
          <a href="mailto:iamsabdurahman@gmail.com" class="contact-link">
          <div class="contact-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
              <polyline points="22,6 12,13 2,6"></polyline>
            </svg>
          </div></a>
          <h3>Email</h3>
          <a href="mailto:iamsabdurahman@gmail.com" aria-label="Email to collaborate or connect" class="contact-link">iamsabdurahman@gmail.com</a>
        </div>

        <div class="contact-card">
          <a href="https://github.com/sabdulrahman" target="_blank" rel="noopener noreferrer" class="contact-link">
          <div class="contact-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
            </svg>
          </div></a>
          <h3>GitHub</h3>
          <a href="https://github.com/sabdulrahman" aria-label="Visit my GitHub" target="_blank" rel="noopener noreferrer" class="contact-link">@sabdulrahman</a>
        </div>

        <div class="contact-card">
          <a href="https://www.linkedin.com/in/iamsabdurahman/" target="_blank" rel="noopener noreferrer" class="contact-link">
          <div class="contact-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path>
              <rect x="2" y="9" width="4" height="12"></rect>
              <circle cx="4" cy="4" r="2"></circle>
            </svg>
          </div></a>
          <h3>LinkedIn</h3>
          <a href="https://www.linkedin.com/in/iamsabdurahman/" aria-label="Connect with me via LinkedIn" target="_blank" rel="noopener noreferrer" class="contact-link">@iamsabdurahman</a>
        </div>
      </div>

      <!-- Contact Form -->
      <div class="contact-form-container">
        <form class="contact-form" id="contactForm">
          <div class="form-group">
            <input type="text" id="name" name="name" required>
            <label for="name">Name</label>
            <div class="line"></div>
          </div>

          <div class="form-group">
            <input type="email" id="email" name="email" required>
            <label for="email">Email</label>
            <div class="line"></div>
          </div>

          <div class="form-group">
            <input type="text" id="subject" name="subject" required>
            <label for="subject">Subject</label>
            <div class="line"></div>
          </div>

          <div class="form-group">
            <textarea id="message" name="message" required></textarea>
            <label for="message">Message</label>
            <div class="line"></div>
          </div>

          <button type="submit" class="submit-btn">
            Send Message
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="22" y1="2" x2="11" y2="13"></line>
              <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
            </svg>
          </button>
        </form>
      </div>
    </div>
  </div>
</section>
<script>

  document.addEventListener('DOMContentLoaded', () => {
    const contactForm = document.getElementById('contactForm');
    const SUBMISSION_TIMEOUT = 30000; // 30 seconds
    let lastSubmissionTime = 0;

    // Form validation function
    const validateForm = (formData, formEntries) => {
      const errors = [];
      const name = formData.get(formEntries.name);
      const email = formData.get(formEntries.email);
      const subject = formData.get(formEntries.subject);
      const message = formData.get(formEntries.message);
      const honeypot = document.getElementById('website')?.value;

      // Check honeypot
      if (honeypot) {
        return ['Spam detected'];
      }

      // Check submission timeout
      const now = Date.now();
      if (now - lastSubmissionTime < SUBMISSION_TIMEOUT) {
        errors.push('Please wait 30 seconds before submitting again');
        return errors;
      }

      // Name validation
      if (!name || name.trim().length < 2) {
        errors.push('Name must be at least 2 characters long');
      }

      // Email validation
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!email || !emailRegex.test(email)) {
        errors.push('Please enter a valid email address');
      }

      // Subject validation
      if (!subject || subject.trim().length < 3) {
        errors.push('Subject must be at least 3 characters long');
      }

      // Message validation
      if (!message || message.trim().length < 10) {
        errors.push('Message must be at least 10 characters long');
      } else if (message.length > 1000) {
        errors.push('Message is too long (max 1000 characters)');
      }

      // Check for spam patterns
      const spamPatterns = [
        '[url=', '[link=', 'http://', 'https://', '<a href',
        'casino', 'viagra', 'lottery', 'bitcoin', 'crypto'
      ];

      if (spamPatterns.some(pattern =>
              message.toLowerCase().includes(pattern.toLowerCase()))) {
        errors.push('Message contains disallowed content');
      }

      // Check for repeated characters (potential spam)
      if (/(.)\1{4,}/.test(message)) {
        errors.push('Message contains too many repeated characters');
      }

      return errors;
    };

    // Function to display error messages
    const showErrors = (errors) => {
      // Remove existing error messages
      const existingErrors = document.querySelector('.form-errors');
      if (existingErrors) {
        existingErrors.remove();
      }

      if (errors.length > 0) {
        const errorContainer = document.createElement('div');
        errorContainer.className = 'form-errors';
        errorContainer.innerHTML = `
                <div class="error-messages">
                    ${errors.map(error => `<p class="error-message">${error}</p>`).join('')}
                </div>
            `;
        contactForm.insertBefore(errorContainer, contactForm.firstChild);
      }
    };

    contactForm.addEventListener('submit', async (e) => {
      e.preventDefault();

      const submitBtn = contactForm.querySelector('.submit-btn');
      const originalBtnText = submitBtn.innerHTML;

      // Define form entries
      const formEntries = {
        name: 'entry.2095136442',
        email: 'entry.1624554038',
        subject: 'entry.612845369',
        message: 'entry.991645304'
      };

      // Create and populate FormData
      const formData = new FormData();
      formData.append(formEntries.name, contactForm.querySelector('#name').value.trim());
      formData.append(formEntries.email, contactForm.querySelector('#email').value.trim());
      formData.append(formEntries.subject, contactForm.querySelector('#subject').value.trim());
      formData.append(formEntries.message, contactForm.querySelector('#message').value.trim());

      // Validate form
      const errors = validateForm(formData, formEntries);

      if (errors.length > 0) {
        showErrors(errors);
        return;
      }

      // Show loading state
      submitBtn.innerHTML = 'Sending...';
      submitBtn.disabled = true;

      try {
        await fetch('https://docs.google.com/forms/u/0/d/e/1FAIpQLSdiLeXVZUwft5gU6_l-ITBtYImlR43wYrsY19MMgp0x93Ix_g/formResponse', {
          method: 'POST',
          mode: 'no-cors',
          body: formData
        });

        // Update last submission time
        lastSubmissionTime = Date.now();

        // Show success message
        submitBtn.innerHTML = 'Message Sent!';
        submitBtn.style.background = 'var(--success-color, #4CAF50)';

        // Remove any error messages
        const existingErrors = document.querySelector('.form-errors');
        if (existingErrors) {
          existingErrors.remove();
        }

        // Reset form
        contactForm.reset();

      } catch (error) {
        console.error('Error sending message:', error);
        showErrors(['Failed to send message. Please try again later.']);

        // Show error message
        submitBtn.innerHTML = 'Error Sending';
        submitBtn.style.background = 'var(--error-color, #f44336)';
      } finally {
        // Reset button after delay
        setTimeout(() => {
          submitBtn.innerHTML = originalBtnText;
          submitBtn.style.background = '';
          submitBtn.disabled = false;
        }, 3000);
      }
    });
  });

  // Function to show thank you message
  function showThankYouMessage() {
    // Create and style the message element
    const messageDiv = document.createElement('div');
    messageDiv.textContent = 'Thank you for connecting!';
    messageDiv.style.cssText = `
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        background-color: #4CAF50;
        color: white;
        padding: 16px 32px;
        border-radius: 4px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        z-index: 1000;
        transition: opacity 0.3s ease;
    `;

    // Add to document
    document.body.appendChild(messageDiv);

    // Remove after 7 seconds with fade effect
    setTimeout(() => {
      messageDiv.style.opacity = '0';
      setTimeout(() => {
        document.body.removeChild(messageDiv);
      }, 300); // Additional 300ms for fade out animation
    }, 7000);
  }


</script>